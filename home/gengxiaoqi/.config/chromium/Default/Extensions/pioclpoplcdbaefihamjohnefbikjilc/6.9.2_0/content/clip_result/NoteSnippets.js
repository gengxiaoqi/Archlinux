/*! Copyright 2009-2016 Evernote Corporation. All rights reserved. */
function NoteSnippets(a,b,c,d,e,f,g,h){"use strict";function i(a,b){a&&(s=a),t=b,s&&0!=s.length&&j()}function j(){l(s)}function k(){}function l(b){var c=a;if(c){c.innerHTML="";var d;for(var e in b){g||e%3!=0||(d=document.createElement("div"),d.className="row",c.appendChild(d));var f=document.createElement("div");f.className="container",f.appendChild(p(b[e],e));var h=q(b[e]);h&&f.appendChild(h),g?c.appendChild(f):d.appendChild(f)}t&&t>b.length&&c.appendChild(m())}}function m(){var a,c=t-s.length;a=1==c?Browser.i18n.getMessage("popup_oneMoreNoteLink"):Browser.i18n.getMessage("popup_moreNotesLink",[c.toString()]);var d=document.createElement("div");return d.className="moreOnServer",d.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});var a=Browser.extension.getURL("js/main/generateUrlWithTempToken.html?baseUrl="+encodeURIComponent(b)+"&targetUrl="+encodeURIComponent("/Home.action#x="+f));Browser.sendToExtension({name:"main_openTab",url:a})}),d.innerHTML=a,d}function n(a){var b=navigator.language,c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],e=new Date,f="%day %monthName %year",g="%monthName %day, %year",h="%year\u5e74%month\u6708%day\u65e5",i="%year\u5e74%monthName%day\u65e5";if(a.getMonth()===e.getMonth()&&a.getDate()===e.getDate()&&a.getFullYear()===e.getFullYear())return Browser.i18n.getMessage("Today");if(e.valueOf()-a.valueOf()<=6048e5&&e.getDay()!==a.getDay())return Browser.i18n.getMessage(c[a.getDay()]);var j=f,k=a.getDate();return b.match(/en-us/i)&&(j=g,k+=1==k||21==k||31==k?"st":2==k||22==k?"nd":3==k||23==k?"rd":"th"),b.match(/^zh/i)?j=h:b.match(/^ja/i)&&(j=i),j=j.replace(/%day/,k),j=j.replace(/%year/,a.getFullYear()),j=j.replace(/%monthName/,Browser.i18n.getMessage(d[a.getMonth()])),j=j.replace(/%month/,a.getMonth()+1)}function o(b,c,d){var e=a.querySelector("img[guid='"+b.guid+"']");e&&(e.src=b.datauri,e.removeAttribute("guid"))}function p(a,f){var g,i=document.createElement("div"),j=document.createElement("a");if(j.className="noteLink","expert"==a.type?(i.className="expert",j.target="_parent",j.href="evernote://business/user/"+a.id,i.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"}),h&&h(!0,!0)})):(i.className="noteBlock",j.target="_blank",j.href=GlobalUtils.getNoteURI(b,{shardId:a.shardId||d,noteGuid:a.guid},c,e.pers),i.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"}),h&&h(a.inBusinessNotebook)})),"expert"==a.type)g=document.createElement("img"),g.className="smallimage",g.setAttribute("guid",a.id),Browser.sendToExtension({name:"downloadThumbnail",guid:a.id,method:"GET",size:60,url:b+"/user/"+a.id+"/photo"});else if(a.thumbsquare){var k=110;devicePixelRatio>=1.5&&(k*=2),g=document.createElement("img"),a.snippet&&(k=60,devicePixelRatio>=1.5&&(k*=2),g.className="smallimage"),g.setAttribute("guid",a.guid),Browser.sendToExtension({name:"downloadThumbnail",guid:a.guid,inBusinessNotebook:a.inBusinessNotebook,size:k,url:b+a.thumbsquare,type:"note"})}var l=document.createElement("div");if(l.className="snippet",a.snippet){var m=document.createElement("p");m.textContent=a.snippet,m.className="snippettext",a.thumbsquare&&(m.className+=" mixed")}var o=document.createElement("h1");if(o.textContent=a.title,"expert"==a.type){l.appendChild(g);var p=document.createElement("div");if(p.className="divider",l.appendChild(p),l.appendChild(o),a.role){var q=document.createElement("div");q.textContent=a.role,q.className="role",l.appendChild(q)}var r=document.createElement("a");r.className="seeMoreLink",r.textContent=Browser.i18n.getMessage("seeMore"),l.appendChild(r)}else{var s=document.createElement("p"),t=new Date(a.updated);s.textContent=n(t),s.className="date",l.appendChild(o),l.appendChild(s),a.snippet&&l.appendChild(m),a.thumbsquare&&l.appendChild(g)}return i.appendChild(l),i.appendChild(j),i}function q(a){if(a.contact||a.notebookName){u=!0;var b=document.createElement("div");return a.contact?b.className="contactName":b.className="notebookName",b.innerText=a.contact||a.notebookName,b.title=b.innerText,b}return null}function r(){return u}var s,t=0,u=!1;i(),this.setNotes=i,this.show=k,this.renderBlocks=l,this.hasAtLeastOneNotebookName=r,Browser.addMessageHandlers({receiveThumbnail:o}),Object.preventExtensions(this)}Object.preventExtensions(NoteSnippets);