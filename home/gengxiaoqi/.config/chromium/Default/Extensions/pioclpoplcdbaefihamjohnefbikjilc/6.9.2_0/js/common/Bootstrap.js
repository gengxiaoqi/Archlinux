/*! Copyright 2009-2016 Evernote Corporation. All rights reserved. */
function Bootstrapper(){"use strict";function a(a){w=new JsonRpc(null,["UserStore.checkVersion","UserStore.getBootstrapInfo"],extension.getBaseUrl());var d=j.trim();""!==d&&(u=[d,d]),w.initWithUrl(m+u[a]+"/json");var e=new Date,f=e.getUTCMonth()+1<=9?"0"+(e.getUTCMonth()+1):(e.getUTCMonth()+1).toString(),g=f+e.getUTCDate().toString()+e.getUTCFullYear().toString(),h=Persistent.get("checkedVersion");h||(h={}),h[g]||(h[g]={});for(var i in h)i!==g&&delete h[i];Persistent.set("checkedVersion",h);var k=parseInt(Persistent.get("deviceID").substr(0,3),16)%1440,l=60*e.getUTCHours()+e.getUTCMinutes();if(t++,(void 0===h[g][u[a]]||null===h[g][u[a]])&&l>=k){h[g][u[a]]=!0,Persistent.set("checkedVersion",h);var n=GlobalUtils.generateSystemInfo(),o="EvernoteClipper/"+Browser.EVERNOTE_VERSION+"; "+n.browser.replace(" ","/")+"; "+n.os.replace(" ","/");w.client.UserStore.checkVersion(function(b,d){d&&"number"==typeof d.code&&200!=d.code||(h[g][u[a]]=b,Persistent.set("checkedVersion",h)),c(b,d)},o,EDAM_VERSION_MAJOR,EDAM_VERSION_MINOR),y&&(x=setTimeout(b,3e3))}else c(void 0===h[g][u[a]]||null===h[g][u[a]]?!0:h[g][u[a]])}function b(){x&&clearTimeout(x),w.client.UserStore.getBootstrapInfo(d,i),x=setTimeout(d,3e3)}function c(a,c){c&&("number"==typeof c.code&&200!=c.code?(log.warn("HTTP Error checking version. Assuming OK."),a=!0):log.log("Error checking version: "+JSON.stringify(c))),a===!0?y?b():e(p):(p=!1,alert(Browser.i18n.getMessage("checkVersionWarning")),e(p))}function d(b,c){if(x&&clearTimeout(x),b&&b.profiles&&b.profiles.list){b=b.profiles.list;for(var d=0,f=q.getName(),g=0;g<b.length;g++)"undefined"!=typeof b[g].name&&b[g].name===f&&(d=g);Persistent.set("BootstrapInfoIndex",d),Persistent.set("BootstrapInfo",b)}else{if(!(t>=2))return void a(s);log.error("Couldn't contact either bootstrap server. Using what we've got...")}e(p),o=!1}function e(a){for(var b=n.length-1;b>=0;b--){try{n[b](a)}catch(c){log.error("Error running callback: "+c.message+c.stack)}n.pop()}n=[]}function f(b,c){return b&&n.push(b),navigator.onLine?void(o||(y=c,a(r),o=!0)):(log.log("Bootstrapping while offline, will use existing info."),void e(p))}var g="zh-CN",h=!1,i=navigator.language,j=options.get("overrideServiceURL")||"",k=options.get("simulateSimplifiedChinese"),l=options.get("useStage"),m=options.get("secureProto");k&&(log.log("Will simulate Simplified Chinese."),h=!0,i=g);var n=[],o=!1,p=!0,q=new BootstrapInfo,r=0;i===g&&(r=1);var s=r?0:1,t=0,u=["www.evernote.com","app.yinxiang.com"],v=["stage.evernote.com","stage-china.evernote.com"];l&&(u=v);var w,x,y=!0;this.bootstrap=f,Object.preventExtensions(this)}function BootstrapInfo(){function a(a){if("name"==a)return b();if("serviceHost"==a){var d=options.get("overrideServiceURL");if(d&&(d=d.trim()),d)return log.log("Using overidden serviceHost: "+d),d}if("undefined"==typeof h[a])return log.error("Invalid Bootstrap Info Key: "+a),!1;var e=c(),f=Persistent.get(g);return f&&f.length>e&&f[e].settings?f[e].settings[a]:h[a]}function b(){var a=c(),b=Persistent.get(g);return b&&b.length>a&&"undefined"!=typeof b[a].name?b[a].name:""}function c(){var a=Persistent.get(f);return a?a:0}function d(a){Persistent.set(f,a);var b=c();a!==b&&Persistent.clear("savedAuthInfo")}function e(){var a=Persistent.get(g);return a&&a.length?a.length:0}var f="BootstrapInfoIndex",g="BootstrapInfo",h={serviceHost:"www.evernote.com",marketingUrl:"http://www.evernote.com",supportUrl:"https://support.evernote.com",accountEmailDomain:"www.evernote.com",enableFacebookSharing:!0,enableGiftSubscriptions:!0,enableSharedNotebooks:!0,enableSingleNoteSharing:!0,enableSponsoredAccounts:!0,enableSupportTickets:!0,enableTwitterSharing:!0,enableLinkedInSharing:!0,enableGoogle:!0};this.getIndex=c,this.setIndex=d,this.getLength=e,this.get=a,this.getName=b,Object.preventExtensions(this)}Object.preventExtensions(Bootstrapper),Object.preventExtensions(BootstrapInfo);