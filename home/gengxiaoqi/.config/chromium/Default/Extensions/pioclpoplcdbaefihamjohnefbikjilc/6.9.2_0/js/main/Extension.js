/*! Copyright 2009-2016 Evernote Corporation. All rights reserved. */
function Extension(){"use strict";function a(){Persistent.get("deviceID")||Persistent.set("deviceID",UUID.generateGuid().slice(0,32))}function b(a){if(!a)return void log.warn("Version out of date!");if(Browser.setPopup(cb),!gb){if(gb=!0,$a=new BootstrapInfo,auth=new Auth,bb=new ExternalMessaging,bb.setMessageHandlers({submitNote:va}),auth.getUserInfo().authenticationToken){var b=auth.getUserInfo();b.urls||Ra().getUserUrls(b.authenticationToken,function(a){b.urls=a}),b.bizAuthenticationToken&&!b.bizUrls&&Ra().getUserUrls(b.bizAuthenticationToken,function(a){b.bizUrls=a})}if(Z(),c(),versionDetect.getLastVersionParsed()[0]<=5&&6===versionDetect.getSourceVersionParsed()[0]&&auth.logoutAll(),6!==versionDetect.getSourceVersionParsed()[0])throw new Error("check if need to update version");auth.getUserInfo().authenticationToken&&(auth.getUserInfo().version||0)<Auth.VERSION?auth.updateUserStatus(_):_(),firstTime.startUp(),p(),q(),r(),s(),t(),firstTime.msgHandlerOnInit(function(){p()}),H({startup:!0}),auth.getCurrentUser()&&A({category:"Install or Update",action:"set_user_cd",data:C()}),w(),$(),experiment.eligibleForImageExperiment()&&Analytics.trackEvent("split_test","retn_web_saveToEvernoteButton_CC-1897_v1",experiment.isInGroupA()?"A_button":"B_control",null,null,null,[{slot:Analytics.CD.EXPORT_TO_DB,value:1}])}}function c(){if(!SAFARI){if(db)return;db=!0,chrome.contextMenus.removeAll(function(){o()})}}function d(){alert(Browser.i18n.getMessage("contextMenuPleaseLogin"))}function e(a){var b=safari.application.activeBrowserWindow.activeTab,c=a.userInfo;switch(a.command){case ib.clipPage:i(b);break;case ib.clipScreenshot:j(b);break;case ib.clipSelection:k(c,b);break;case ib.clipImage:l(c,b);break;case ib.clipPDF:m(b);break;case ib.clipUrl:n(b)}}function f(a){var b=a.userInfo;if(b&&b.url){if(!b.url.match(/^https?/i))return;if(b.url.match(/^https?:\/\/extensions.apple.com/i))return}a.contextMenu.appendContextMenuItem(ib.clipPage,Browser.i18n.getMessage("safariContextClipPage"),ib.clipPage),a.contextMenu.appendContextMenuItem(ib.clipScreenshot,Browser.i18n.getMessage("safariContextClipScreenshot"),ib.clipScreenshot),a.userInfo&&a.userInfo.selection&&a.contextMenu.appendContextMenuItem(ib.clipSelection,Browser.i18n.getMessage("safariContextClipSelection"),ib.clipSelection),a.userInfo&&a.userInfo.node&&"img"==a.userInfo.node.toLowerCase()&&a.contextMenu.appendContextMenuItem(ib.clipImage,Browser.i18n.getMessage("safariContextClipImage"),ib.clipImage),a.userInfo&&a.userInfo.pdf&&a.contextMenu.appendContextMenuItem(ib.clipPDF,Browser.i18n.getMessage("safariContextClipPDF"),ib.clipPDF),a.contextMenu.appendContextMenuItem(ib.clipUrl,Browser.i18n.getMessage("safariContextClipUrl"),ib.clipUrl)}function g(a){return a.plus?"Plus":a.bizAuthenticationToken?"Business":a.premium?"Premium":"Basic"}function h(a,b){switch(a.menuItemId){case"fullPage":i(b);break;case"screenshot":j(b);break;case"selection":k(a,b);break;case"image":l(a,b);break;case"pdf":m(b);break;case"url":n(b)}}function i(a){_a.recordActivity(auth.isAuthenticated),auth.isAuthenticated(function(b){b?Browser.sendToTab(a,{name:"startSubmission",clipType:"fullPage",contextMenu:!0,smartFilingNotebookAvailable:!1}):d()})}function j(a){_a.recordActivity(auth.isAuthenticated),auth.isAuthenticated(function(b){b?Wa({contextMenu:!0},{tab:a},function(b){Browser.sendToTab(a,{name:"startSubmission",clipType:"screenshot",contextMenu:!0,screenshotUrl:b,smartFilingNotebookAvailable:!1})}):d()})}function k(a,b){_a.recordActivity(auth.isAuthenticated),auth.isAuthenticated(function(c){c?Browser.sendToTab(b,{name:"startSubmission",clipType:"selection",contextMenu:!0,selectionText:a.selectionText,smartFilingNotebookAvailable:!1}):d()})}function l(a,b){_a.recordActivity(auth.isAuthenticated),auth.isAuthenticated(function(c){c?Browser.sendToTab(b,{name:"startSubmission",clipType:"image",contextMenu:!0,imageUrl:a.srcUrl,smartFilingNotebookAvailable:!1}):d()})}function m(a){_a.recordActivity(auth.isAuthenticated),auth.isAuthenticated(function(b){b?Browser.sendToTab(a,{name:"startSubmission",clipType:"pdf",contextMenu:!0,smartFilingNotebookAvailable:!1}):d()})}function n(a){_a.recordActivity(auth.isAuthenticated),auth.isAuthenticated(function(b){b?Browser.sendToTab(a,{name:"startSubmission",clipType:"url",contextMenu:!0,smartFilingNotebookAvailable:!1}):d()})}function o(){db=!1;var a=["http://*/*","https://*/*"],b=["http://*/*","https://*/*","chrome-extension://encfpfilknmenlmjemepncnlbbjlabkc/*","chrome-extension://oemmndcbldboiebfnladdacbdfmadadm/*","chrome-extension://mhjfbmdgcfjbbpaeojofohoefgiehjai/*"];EDGE&&(b=a),chrome.contextMenus.create({id:"fullPage",title:Browser.i18n.getMessage("contextMenuClipPage"),contexts:["page","image","selection"],documentUrlPatterns:a}),chrome.contextMenus.create({id:"image",title:Browser.i18n.getMessage("contextMenuClipImage"),contexts:["image"],targetUrlPatterns:a}),chrome.contextMenus.create({id:"selection",title:Browser.i18n.getMessage("contextMenuClipSelection"),contexts:["selection"],documentUrlPatterns:b}),chrome.contextMenus.create({id:"url",title:Browser.i18n.getMessage("contextMenuClipUrl"),contexts:["all"],documentUrlPatterns:b}),EDGE||(chrome.contextMenus.create({id:"screenshot",title:Browser.i18n.getMessage("contextMenuClipScreenshot"),contexts:["page","image","selection"],documentUrlPatterns:a}),chrome.contextMenus.create({id:"pdf",title:Browser.i18n.getMessage("contextMenuClipPDF"),contexts:["all"],documentUrlPatterns:b})),chrome.contextMenus.onClicked.addListener(function(a,b){b.id==-1?Browser.getCurrentTab(function(b){b&&h(a,b)}):h(a,b)})}function p(){if(SAFARI){var a=function(a,b){if(a&&"clipper"==a.identifier){b&&!/login\.html/.test(a.contentWindow.location.href)&&(a.contentWindow.location.href=cb);var c=a.contentWindow.location.href;/login\.html/.test(c)?(oa()>1?a.height=421:a.height=392,a.width=313):/registration\.html/.test(c)?(a.width=589,a.height=440):/two_factor\.html/.test(c)?(a.width=313,a.height=325):/sso\.html/.test(c)&&(a.width=298,a.height=350)}};safari.application.removeEventListener("validate",function(b){a(b.target.popover)}),safari.application.addEventListener("validate",function(b){a(b.target.popover)}),safari.application.removeEventListener("popover",function(b){a(b.target,!0)}),safari.application.addEventListener("popover",function(b){a(b.target,!0)})}firstTime.needToShowIntro()?(Browser.setPopup(""),Browser.setBrowserActionClickHandler(function(a){firstTime.msgHandlerOnAction(function(){p(),H()})})):auth.isAuthenticated(function(a){a&&(Browser.setPopup(""),Browser.setBrowserActionClickHandler(function(a){auth.isAuthenticated(function(b){if(b){var c={pers:b.authenticationToken};b.bizAuthenticationToken&&(c.biz=b.bizAuthenticationToken),x(null,{tab:a})}else log.warn("logged out while toggling coordinator")})}))})}function q(){function a(a){SAFARI?(H(),a.target.browserWindow?Browser.sendToTab(a.target,{name:"isExtensionOpen"}):a.target.activeTab&&Browser.sendToTab(a.target.activeTab,{name:"isExtensionOpen"})):(H(),Browser.sendToTab({id:a.tabId},{name:"isExtensionOpen"}))}SAFARI?safari.application.addEventListener("activate",a,!0):(chrome.tabs.onActivated.addListener(a),chrome.windows.onFocusChanged.addListener(function(b){chrome.tabs.query({active:!0,windowId:b},function(b){b&&b.length>0?a({tabId:b[0].id}):log.warn("chrome tabs query did not return a result while changing window focus")})}))}function r(){function a(){auth.getUserInfo().authenticationToken&&auth.updateUserStatus(_)}var b=/^https:\/\/(?:app|www|stage|stage-china)\.(?:evernote|yinxiang)\.com\/subscriptions/;SAFARI?safari.application.addEventListener("beforeNavigate",function(c){b.test(c.target.url)&&a()}):(chrome.tabs.onUpdated.addListener(function(c,d){d.url&&b.test(d.url)?ab=c:ab===c&&d.url&&a()}),chrome.tabs.onRemoved.addListener(function(a){ab===a&&(ab=0)}))}function s(){SAFARI||chrome.tabs.onUpdated.addListener(function(a,b,c){b.url&&Browser.sendToTab(c,{name:"urlChanged"})})}function t(){SAFARI||(chrome.tabs.onUpdated.addListener(function(a,b,c){if(b.status)if("loading"==b.status)hb[a]={loaded:!1,invoke:!1};else if("complete"==b.status){var d=hb[a];d&&(d.loaded=!0,d.invoke===!0&&(x(null,d.sender,null),d.invoke=!1),hb[a]=d)}}),chrome.tabs.onRemoved.addListener(function(a,b){delete hb[a]}))}function u(a){experiment.eligibleForImageExperiment()&&experiment.imageHoverEnabledInSettings()&&experiment.isInGroupA()&&auth.isAuthenticated(function(b){b&&Browser.sendToTab(a.tab,{name:"enableSaveToEvernote"})})}function v(a,b,c){var d=hb[b.tab.id];d&&d.loaded===!1&&(d.loaded=!0,d.invoke===!0&&(x(null,d.sender,null),d.invoke=!1),hb[b.tab.id]=d),u(b)}function w(){}function x(a,b,c){auth.isAuthenticated(function(d){if(d)if(experiment.eligibleForImageExperiment()&&Analytics.trackEvent("split_test","retn_web_saveToEvernoteButton_CC-1897_v1",experiment.isInGroupA()?"A_button":"B_control",null,null,null,[{slot:Analytics.CD.EXPORT_TO_DB,value:1}]),SAFARI&&void 0===b.tab.page)alert(Browser.i18n.getMessage("popup_couldntStart"));else if(EDGE&&/\.pdf$/.test(b.tab.url))alert(Browser.i18n.getMessage("popup_unsupportedScheme"));else{var e=hb[b.tab.id];if(e&&e.loaded===!1)return e.sender=b,e.invoke=!0,void(hb[b.tab.id]=e);Browser.sendToTab(b.tab,{name:"insertSerializationScripts"});var f;a&&a.selectedElement&&(f=a.selectedElement),Browser.sendToTab(b.tab,{name:"toggleCoordinator",bizUser:!!d.businessId,bizComplete:!!d.bizAuthenticationToken,selectedElement:f},function(c){c&&c.message&&log.error("Error toggling coordinator: "+c.message),chrome&&chrome.runtime&&chrome.runtime.lastError&&log.error("Error toggling coordinator: "+chrome.runtime.lastError),a&&a.afterAuth||(c||chrome&&chrome.runtime&&chrome.runtime.lastError)&&(b.tab&&b.tab.url&&0===b.tab.url.indexOf("file://")?alert(Browser.i18n.getMessage("popup_couldntStartLocalFile")):J(b.tab.url)?alert(Browser.i18n.getMessage("illegalUrlClipFailure")):alert(Browser.i18n.getMessage("popup_couldntStart")))})}else log.error("logged out while toggling clipper.");c&&c()})}function y(a,b,c){}function z(a,b,c,d,e){var f=[],g=Math.max(3-a.length,2),h=[],i=[];a||(a=[]),c||(c=[]);for(var j=0;j<c.length&&!(h.length>=g&&i.length>=g);j++)c[j].shardId=d,c[j].inBusinessNotebook=!0,e[c[j].notebookGuid].joined?h.push(c[j]):(c[j].notebookName=e[c[j].notebookGuid].name,i.push(c[j]));for(var k=Math.min(g,h.length),l=Math.max(g-k,1),m=Math.min(l,i.length),n=h.slice(0,g-m),j=0;j<m;j++)n.push(i[j]);f=a.slice(0,3-n.length);for(var j=0;j<n.length;j++)f.push(n[j]);for(var j=0;j<f.length;j++)f[j].shardId||(f[j].shardId=b);return f}function A(a,b,c){auth.getCurrentUser()&&(a.data||(a.data=[]),a.data.push({slot:Analytics.CD.USER_TYPE,value:g(auth.getUserInfo())})),Analytics.trackEvent(a.category,a.action,a.label,a.value,a.startSession,a.endSession,a.data)}function B(a,b,c){Analytics.trackTiming(a.category,a.variableName,a.time,a.label)}function C(){var a=[{slot:Analytics.CD.SERVICE_HOST,value:na("serviceHost")},{slot:Analytics.CD.DEVICE_ID,value:Persistent.get("deviceID")}];return/china/i.test(na("name"))?a.push({slot:Analytics.CD.GLOBAL_USER_ID,value:"YX"+auth.getCurrentUser()}):a.push({slot:Analytics.CD.GLOBAL_USER_ID,value:"EN"+auth.getCurrentUser()}),auth.getUserInfo().businessId&&a.push({slot:Analytics.CD.BUSINESS_VAULT_ID,value:auth.getUserInfo().businessId}),a}function D(){Browser.setTitle(Browser.i18n.getMessage("webClipperUpdated")),Browser.setIcon("images/wc6-update")}function E(){return firstTime.isUpgraded()?void D():(Browser.setTitle(Browser.i18n.getMessage("BrowserActionTitle")),void Browser.setIcon("images/web-clipper"))}function F(){return firstTime.isUpgraded()?void D():(Browser.setTitle(Browser.i18n.getMessage("signInPrompt")),void Browser.setIcon("images/web-clipper-sign-in"))}function G(){Browser.setIcon("images/close-ext")}function H(a,b,c){return firstTime.isUpgraded()?void D():void(auth.getUserInfo().authenticationToken?a&&a.startup||E():F())}function I(a,b,c){if($a.getLength()>1){var d=$a.getIndex();d=(d+1)%2,$a.setIndex(d),c&&c()}}function J(a){return a=(a+"").toLowerCase(),!!a.match(/^https?:\/\/chrome.google.com\/(extensions|webstore)/)}function K(a,b,c){b&&b.tab&&Browser.sendToTab(b.tab,{name:"receivePersistentValue","for":a["for"],key:a.key,value:Persistent.get(a.key),currentUserId:auth.getCurrentUser()})}function L(a,b,c){Persistent.set(a.key,a.value)}function M(a,b,c){var d=Persistent.get(a.key);d||(d={}),d[a.userId]=a.value,Persistent.set(a.key,d)}function N(a,b,c){M({key:a.key,value:a.value,userId:auth.getCurrentUser()})}function O(a,b,c){var d=Persistent.get(a.key);d||(d=0),d+=a.delta,Persistent.set(a.key,d)}function P(a,b,c){Persistent.clearAll()}function Q(a,b,c){function d(){kb[this.req.url]?(Browser.sendToTab(b.tab,{name:"receiveThumbnail",guid:this.req.guid,datauri:kb[this.req.url]}),jb.shift(),jb.length>0&&d.call(jb[0])):this.req.send(this.payload)}var e="";/^get$/i.test(a.method)?a.url+=a.size?(/\?/.test(a.url)?"&":"?")+"size="+a.size:"":a.size&&(e="size="+a.size);var f=new XMLHttpRequest;f.url=a.url,f.guid=a.guid,f.method=a.method||"POST",f.open(f.method,a.url),f.responseType="arraybuffer",f.onreadystatechange=function(){if(4===this.readyState){if(200===this.status){for(var a="",c=new Uint8Array(this.response),e=0;e<c.length;e++)a+=String.fromCharCode(c[e]);kb[this.url]="data:"+this.getResponseHeader("Content-type")+";base64,"+btoa(a),Browser.sendToTab(b.tab,{name:"receiveThumbnail",guid:this.guid,datauri:kb[this.url]})}else if(401===this.status&&this.url)return void Ua(function(a){return function(b){var c=new XMLHttpRequest;c.open(a.method,options.get("secureProto")+$a.get("serviceHost")+"/SetAuthToken.action?auth="+encodeURIComponent(b)+"&targetUrl="+encodeURIComponent(a.url)),c.guid=a.guid,c.responseType="arraybuffer",c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=a.onreadystatechange,c.send(jb[0].payload)}}(this));jb.shift(),jb.length>0&&d.call(jb[0])}},f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"note"===a.type&&(e+=(e.length?"&":"")+"auth=",e+=a.inBusinessNotebook?encodeURIComponent(auth.getUserInfo().bizAuthenticationToken):encodeURIComponent(auth.getUserInfo().authenticationToken)),jb.push({req:f,payload:e}),1===jb.length&&d.call(jb[0])}function R(a,b,c){var d=new Image;if(d.onload=function(){var c=document.createElement("canvas");c.width=Math.min(a.cropToWidth,this.width),c.height=Math.min(a.cropToHeight,this.height);var e=c.getContext("2d"),f=Math.min(this.width/c.width,this.height/c.height);e.drawImage(d,(this.width-c.width*f)/2,(this.height-c.height*f)/2,c.width*f,c.height*f,0,0,c.width,c.height),Browser.sendToTab(b.tab,{name:"receiveCroppedImage",datauri:c.toDataURL(),url:a.url,height:c.height,width:c.width})},d.onerror=function(){Browser.sendToTab(b.tab,{name:"receiveCroppedImage",url:a.url})},EDGE){var e=new XMLHttpRequest;e.responseType="blob";var f=a.url;f.startsWith("//")&&(f="http:"+f),e.open("get",f),e.onload=function(){var a=new FileReader;a.onloadend=function(){d.src=a.result},a.onerror=function(){Browser.sendToTab(b.tab,{name:"receiveCroppedImage",url:f})},a.readAsDataURL(e.response)},e.onerror=function(){Browser.sendToTab(b.tab,{name:"receiveCroppedImage",url:f})},e.send()}else d.src=a.url}function S(a,b,c){Browser.sendToTab(b.tab,{name:"l10nData",data:Browser.i18n._getL10nData()}),c&&c()}function T(a,b,c){for(var d in a.options)options.set(d,a.options[d]);c&&c()}function U(a,b,c){var d={},e=a.type||"all";if("all"!==e)options.clear(a.options[e]),a.options[e].forEach(function(a){d[a]=options.get(a)});else for(var f in a.options)options.clear(a.options[f]),a.options[f].forEach(function(a){d[a]=options.get(a)});"shortcutValues"===a.type&&Browser.sendToTab(b.tab,{name:"optionsShortcutCleared",options:d})}function V(a,b,c){b.tab&&Browser.sendToTab(b.tab,a.message)}function W(a,b,c){Browser.getAllTabs(function(b){for(var d=0;d<b.length;d++)Browser.sendToTab(b[d],a.message);c&&c()})}function X(a,b,c){log.log("Restarting background.html..."),Browser.removeMessageHandlers(),window.location.reload(),Browser.getCurrentTab(function(a){a.url.indexOf(Browser.getExtensionURL("options.html"))!==-1&&(log.log("Closing options tab"),SAFARI?safari.application.activeBrowserWindow.activeTab.close():chrome.tabs.remove(a.id,function(){}))})}function Y(a,b,c){function d(c){if("simSearch"==a.type)Browser.sendToTab(b.tab,{name:"simSearch_isAuthenticated",auth:c});else if("clipResult"==a.type)Browser.sendToTab(b.tab,{name:"clipResult_isAuthenticated",auth:c});else if("options"==a.type){var d=experiment.eligibleForImageExperiment()&&experiment.isInGroupA();Browser.sendToTab(b.tab,{name:"options_isAuthenticated",auth:c,saveToEvernote:d})}else if("pdfTooltip"==a.type){var e={name:"pdfTooltip_isAuthenticated",auth:c};if(c&&c.userId){var f=Persistent.get(c.userId+"_pdfTooltipShown"),g=Persistent.get("tooltipLastShown");g||(g={}),g[c.userId]||(g[c.userId]=0),new Date-0>=g[c.userId]+6048e5?(g[c.userId]=new Date-0,Persistent.set("tooltipLastShown",g),Persistent.set(c.userId+"_pdfTooltipShown",!0),e.pdfTooltipShown=f):e.pdfTooltipShown=!0,e.pdfTooltipShown&&SAFARI&&(e.pdfTooltipShownSafari=!0),e.enablePdfPageButton=options.get("enablePdfPageButton")}if(a.bootstrapInfo){e.bootstrapInfo={};for(var h in a.bootstrapInfo)e.bootstrapInfo[h]=$a.get(h)}Browser.sendToTab(b.tab,e)}else if("tooltip"==a.type){var e={name:"tooltip_isAuthenticated",auth:c};if(a.bootstrapInfo){e.bootstrapInfo={};for(var h in a.bootstrapInfo)e.bootstrapInfo[h]=$a.get(h)}Browser.sendToTab(b.tab,e)}else"ewc"===a.type&&Ua(function(a){c&&(c.tempToken=a),Browser.sendToTab(b.tab,{name:"ewc_isAuthenticated",auth:c,baseUrl:ja("secureProto")+na("serviceHost")})})}b&&b.tab?auth.isAuthenticated(d):auth.isAuthenticated(c)}function Z(){!_a&&auth&&(_a=new UsageMetricsManager(auth.isAuthenticated,auth.updateUserStatus,[_]))}function $(){var a=Persistent.get("lastActiveTimes");a||(a={});var b=auth.getCurrentUser();b=b?b:"unauthed",a[b]||(a[b]={time:(new Date).getTime(),count:0}),a.unauthed||(a.unauthed={time:(new Date).getTime(),count:0}),Persistent.set("lastActiveTimes",a)}function _(a){var b=Persistent.get("basicUpsellTimes");b||(b={});var c=auth.getCurrentUser();c&&(auth.getUserInfo().basic&&(!b[c]||a&&a.forceUpdate)?(b[c]=(new Date).getTime()+2592e6,Persistent.set("basicUpsellTimes",b)):auth.getUserInfo().basic||(delete b[c],Persistent.set("basicUpsellTimes",b)))}function aa(a){auth.isAuthenticated(function(b){b?"image"==a.clipType?(Analytics.trackEvent("Content Actions","save_to_evernote_clicked","Image"),Browser.getCurrentTab(function(b){Browser.sendToTab(b,{name:"startSubmission",clipType:"image",contextMenu:!0,imageUrl:a.imageUrl,smartFilingNotebookAvailable:!1})})):"gmail"==a.clipType?(Analytics.trackEvent("Content Actions","save_to_evernote_clicked","Gmail"),Browser.getCurrentTab(function(a){x(null,{tab:a})})):"selection"==a.clipType&&(Analytics.trackEvent("Content Actions","save_to_evernote_clicked","FB"),Browser.getCurrentTab(function(a){x({selectedElement:!0},{tab:a})})):alert(Browser.i18n.getMessage("contextMenuPleaseLogin"))})}function ba(a,b,c){auth.login(a.username,a.password,function(b){b.error||(options.set("useSearchHelper",!!a.useSearchHelper),b.username&&(Browser.setBrowserActionClickHandler(function(a){x(null,{tab:a})}),Browser.setPopup("")),_()),c&&c(b)})}function ca(a,b,c){auth.logoutAll(a.authExpired),Browser.sendToTab(b.tab,{name:"logoutCallback"}),Browser.removeBrowserActionClickHandler(),Persistent.clear("BootstrapInfoIndex"),Persistent.clear("BootstrapInfo"),xa()}function da(){auth.logoutAll(!0),Browser.removeBrowserActionClickHandler(),Browser.setPopup(cb)}function ea(a,b,c){var d="clipper_chr";SAFARI?d="clipper_saf":OPERA?d="clipper_op":YANDEX?d="clipper_yan":EDGE&&(d="clipper_edg");var e=new FormData;e.append("code",d);var f=new XMLHttpRequest;f.open("POST",options.get("secureProto")+$a.get("serviceHost")+"/CreateUserJSON.action?",!0),f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var a=JSON.parse(f.response);c&&c({captcha:a.captcha,submit:a.submit})}else 0===f.status?(log.error("couldn't get registration form links because of network error"),c&&c({error:"NETWORK"})):4==f.readyState&&log.error("couldn't get registration form links because of error: "+f.status)},f.send(e)}function fa(a,b,c){Browser.sendToTab(b.tab,{name:"getInfo"})}function ga(a,b,c){function d(){var c;c="Google"!==a.info.searchEngine&&s.bizAuthenticationToken?f():e(),Browser.sendToTab(b.tab,{name:"simsearch_receiveRelatedNotes",noSimsearchResultsShown:Persistent.get(s.userId+"_noSimsearchResultsShown"),relatedNotes:c,searchEngine:a.info.searchEngine,tokens:{pers:s.authenticationToken,biz:s.bizAuthenticationToken}})}function e(){if(s.bizAuthenticationToken){for(var a=[],b=[],c=0;c<q.length&&!(a.length>=3&&b.length>=3);)q[c].shardId=o.shardId,q[c].inBusinessNotebook=!0,t[q[c].notebookGuid].joined?a.push(q[c]):(q[c].notebookName=t[q[c].notebookGuid].name,q[c].contact=q[c].attributes.lastEditedBy||q[c].attributes.author||t[q[c].notebookGuid].contact,b.push(q[c])),c++;var d=Math.max(3-a.length,1),e=Math.min(d,b.length);q=a.slice(0,3-e);for(var f=0;f<e;f++)q.push(b[f]);r.length>0&&(q[Math.max(0,q.length-1)]=r[0])}var g=[];return p.length>0&&g.push(p),q&&q.length>0&&g.push(q),g}function f(){for(var a=Math.max(3-p.length,2),b=[],c=[],d=0;d<q.length&&!(b.length>=a&&c.length>=a);d++)q[d].shardId=o.shardId,q[d].inBusinessNotebook=!0,t[q[d].notebookGuid].joined?b.push(q[d]):(q[d].notebookName=t[q[d].notebookGuid].name,q[d].contact=q[d].attributes.lastEditedBy||q[d].attributes.author||t[q[d].notebookGuid].contact,c.push(q[d]));for(var e=Math.min(a,b.length),f=Math.max(a-e,1),g=Math.min(f,c.length),h=b.slice(0,a-g),d=0;d<g;d++)h.push(c[d]);for(var i=p.slice(0,3-h.length),d=0;d<h.length;d++)i.push(h[d]);r.length>0&&(i[Math.max(0,i.length-1)]=r[0]);var j=[];return i.length>0&&j.push(i),j}function g(c,e){c?(p=c.relatedNotes?c.relatedNotes.list:[],c.debugInfo&&(u.write("QUERY",a.info.query),u.write("TEXT",a.info.recommendationText),u.write("DEBUG_INFO",c.debugInfo)),(s.bizAuthenticationToken&&q&&r||!s.bizAuthenticationToken)&&d()):za(e,b.tab)}function h(a,c){if(a){if(a.relatedNotes){for(var e=0;e<a.containingNotebooks.list.length;e++){var f=a.containingNotebooks.list[e];t[f.guid]={joined:f.hasSharedNotebook,name:f.notebookDisplayName,contact:f.contactName}}q=a.relatedNotes.list}else q=[];a.debugInfo&&u.write("DEBUG_INFO",a.debugInfo),p&&r&&d()}else za(c,b.tab)}function i(a,c){r=[],a?a.experts&&a.experts.list&&a.experts.list.length>0&&r.push({title:a.experts.list[0].name,id:a.experts.list[0].id,type:"expert",role:a.experts.list[0].attributes?a.experts.list[0].attributes.title:null}):za(c,b.tab),p&&q&&d()}function j(){var b={includeTitle:!0,includeUpdated:!0,includeAttributes:!0,includeNotebookGuid:!0},c={url:a.info.url,text:a.info.recommendationText,query:a.info.query,relatedNotesResultSpec:b};return c}function k(){JsonQueue.handleExpensiveOpRequest({shardId:n.shardId,userId:s.userId,type:"pers"},n.client.NoteStoreExtra.getFilingRecommendations,g,s.authenticationToken,j())}function l(){JsonQueue.handleExpensiveOpRequest({shardId:o.shardId,userId:s.userId,type:"biz"},o.client.NoteStoreExtra.getFilingRecommendations,h,s.bizAuthenticationToken,j()),o.client.NoteStore.findRelated(i,s.bizAuthenticationToken,{plainText:a.info.query},{maxExperts:1})}function m(a){if(s=a){var b=ma();n=new JsonRpc(null,["NoteStoreExtra.getFilingRecommendations"],b),n.initWithAuthToken(s.authenticationToken,k),s.bizAuthenticationToken&&(o=new JsonRpc(null,["NoteStoreExtra.getFilingRecommendations","NoteStore.findRelated"],b),o.initWithAuthToken(s.bizAuthenticationToken,l))}}var n,o,p,q,r,s,t={},u=new FSLogWriter("relatedNotesDebugInfo");a.info.recommendationText&&a.info.query&&auth.isAuthenticated(m)}function ha(a,b,c){function d(){if(this.readyState==this.DONE){var a={name:"content_textResource",href:this.href};(200==this.status||0===this.status&&new RegExp("^"+Browser.extension.getURL("")).test(this.href))&&(a.responseText=this.responseText),a.moduleName=this.moduleName,Browser.sendToTab(b.tab,a)}}if(a&&a.href){var e=new XMLHttpRequest;e.href=a.href,e.moduleName=a.moduleName,e.open("GET",a.href),e.onreadystatechange=d,e.send()}}function ia(a,b,c){if(b&&b.tab){var d={name:"config"};if(a.returnName&&(d.name=a.returnName),a.options){d.options={};for(var e in a.options)d.options[e]=options.get(e)}if(a.bootstrapInfo){d.bootstrapInfo={};for(var e in a.bootstrapInfo)$a&&(d.bootstrapInfo[e]=$a.get(e))}Browser.sendToTab(b.tab,d),c&&c(d)}}function ja(a){return options.get(a)}function ka(a,b,c){if(a.name="receiveOption","defaultClipAction"==a.option)if(a.key="clipAction","lastUsed"==options.get("defaultClipAction")){var d=Persistent.get("lastUsedAction");d?a.value=d:a.value="ARTICLE"}else a.value=options.get("clipAction");else a.key=a.option,a.value=options.get(a.key);delete a.option,Browser.sendToTab(b.tab,a)}function la(a,b){options.set(a,b)}function ma(){return options.get("overrideServiceURL")?options.get("overrideServiceURL"):options.get("secureProto")+na("serviceHost")}function na(a){return $a?$a.get(a):""}function oa(){return $a?$a.getLength():0}function pa(a,b,c){qa(a.url),c&&c()}function qa(a,b){if(SAFARI){var c=safari.application.activeBrowserWindow.openTab();c.url=a,b&&b(c)}else chrome.tabs.create({url:a,selected:!0},b)}function ra(a,b,c){var d=600,e=600,f="";if(a.width&&(d=a.width),a.height&&(e=a.height),a.url&&(f=a.url),f)if(SAFARI){var g=safari.application.openBrowserWindow();g.activeTab.url=f,c&&c()}else chrome.windows.create({url:f,width:d,height:e,type:a.type,top:a.top,left:a.left},function(a){c&&c()})}function sa(a,b,c){try{_a.recordActivity()}catch(d){log.error("Failed to record user activity: "+d.trace||d.stack||JSON.stringify(d))}c&&c()}function ta(a,b,d){SAFARI||a.show!=eb&&(eb=a.show,a.show?c():chrome.contextMenus.remove("pdf"))}function ua(a,b,c){if(Array.isArray(a.filename))for(var d=0,e=a.filename.length;d<e;d++)Browser.insertCSS(a.filename[d]);else Browser.insertCSS(a.filename)}function va(a,b,c){A({category:"Clip",action:"external"}),auth.isAuthenticated(function(b){if(!b)return void c({name:"failure",error:"noAuth"});var d=Ma();d.getDefaultNotebook(b.authenticationToken,function(d){d&&d.guid||c({name:"failure",error:"noNotebooks",errorJSON:JSON.stringify(d)});var e=new Submitter({submit:b.authenticationToken,noteStoreUrl:b.urls.noteStoreUrl,authenticationToken:b.authenticationToken,bizAuthenticationToken:b.bizAuthenticationToken},{noteSizeMax:b.noteSizeMax},{submit:b.userId},function(a){"success"===a.name&&(a.noteUrl=GlobalUtils.getNoteURI(ma(),{shardId:a.shardId,noteGuid:a.noteGuid},b.userId,b.authenticationToken)),c(a)},(!0));e.createNoteWithThrift(a.title,d.guid,d.name,!1,d.type,a.tags,a.comment,a.url||"","external",a.content,[])},function(a){c({name:"failure",error:"noNotebooks",errorJSON:JSON.stringify(a)})})})}function wa(a,b,c){function d(a){if("basicUpsell"===ja("simulateClippingError"))return!0;var b=Persistent.get("basicUpsellTimes");return!!(b&&b[a]&&new Date>=b[a]&&auth.getUserInfo().basic)}function e(a,b){if("hitSpeedbump"===ja("simulateClippingError"))return!0;var c=Persistent.get("shownSpeedbump");if(auth.getUserInfo().premium&&(!c||!c[a])){var d=auth.getUserInfo(a).quota,e=Persistent.get("uploaded"),f=b;if(e&&e[a]&&(f+=e[a]),f>=.5*d)return!0}return!1}function f(a,b){if("nearQuota"===ja("simulateClippingError"))return!0;var c=Persistent.get("shownNearQuotaUpsell");if(!c||!c[a]){var d=auth.getUserInfo(a).quota,e=Persistent.get("uploaded"),f=b;if(e&&e[a]&&(f+=e[a]),auth.getUserInfo().basic){if(f>=d-5242880)return!0}else if(f>=d-262144e3)return!0}return!1}function g(c,d,e,f){var g=new Submitter({submit:c,noteStoreUrl:d,authenticationToken:e.authenticationToken,bizAuthenticationToken:e.bizAuthenticationToken},{noteSizeMax:e.noteSizeMax},{submit:f},function(a){h(a,e)},(!1),b.tab);g.createNoteWithThrift(a.title,a.notebook.guid,a.notebook.name,a.notebook.noShareNotes,a.notebook.type,a.tags,a.comment,a.url,a.clipType,a.content,a.resources)}function h(c,g){if("fail"===c.name)c.name="handleFailure",g&&(Persistent.get(g.userId+"_sawRatingsPrompt")||Persistent.clear(g.userId+"_successfulClipsCount"),Persistent.get(g.userId+"_sawReferralCount")<5&&Persistent.clear(g.userId+"_clipsCount_referral")),Browser.sendToTab(b.tab,c),delete fb[a.pendingNoteKey];else if("success"===c.name){c.name="handleSuccess";var h;Persistent.get(g.userId+"_sawRatingsPrompt")||(h=Persistent.get(g.userId+"_successfulClipsCount"),h||(h=0),Persistent.set(g.userId+"_successfulClipsCount",++h)),Persistent.get(g.userId+"_sawReferralCount")<5&&(h=Persistent.get(g.userId+"_clipsCount_referral"),h||(h=0),Persistent.set(g.userId+"_clipsCount_referral",++h)),e(g.userId,c.noteSize)?c.hitSpeedbump=!0:f(g.userId,c.noteSize)?c.nearQuota=!0:d(g.userId)&&(c.showBasicUpsell=!0),delete c.noteSize,Browser.sendToTab(b.tab,c),delete fb[a.pendingNoteKey]}else"showSyncing"===c.name&&Browser.sendToTab(b.tab,{name:"showSyncing"})}fb[a.pendingNoteKey]||(fb[a.pendingNoteKey]={}),fb[a.pendingNoteKey].note=a,fb[a.pendingNoteKey].originatingTab=b;var i=[];if(a.smartFilingNotebookAvailable){var j="accepted_notebook_suggestion";a.changedSmartFilingNotebook&&(j="changed_from_",a.changedSmartFilingNotebook.from.type===GlobalUtils.NOTEBOOK_TYPE_PERSONAL?j+="personal":a.changedSmartFilingNotebook.from.type===GlobalUtils.NOTEBOOK_TYPE_BUSINESS&&(j+="business"),j+="_to_",j+=a.changedSmartFilingNotebook.to.defaultNotebook?"default":a.changedSmartFilingNotebook.to.recentNotebook?"last_used":"another",j+="_",a.changedSmartFilingNotebook.to.type===GlobalUtils.NOTEBOOK_TYPE_PERSONAL?j+="personal":a.changedSmartFilingNotebook.to.type===GlobalUtils.NOTEBOOK_TYPE_LINKED?j+="shared":a.changedSmartFilingNotebook.to.type===GlobalUtils.NOTEBOOK_TYPE_BUSINESS&&(j+="business"),j+="_notebook"),i.push({slot:Analytics.CD.SMART_FILING,value:j})}i.push({slot:Analytics.CD.TAG,value:a.tags&&a.tags.length>0?"added_tags":"no_tags"}),i.push({slot:Analytics.CD.COMMENTS,value:a.comment&&a.comment.trim()?"added_comments":"no_comments"}),i.push({slot:Analytics.CD.EXPORT_TO_DB,value:1}),A({category:"Clip",action:a.clipType,label:a.hostname,startSession:!0,data:i}),a.notebook||(a.notebook={type:GlobalUtils.NOTEBOOK_TYPE_PERSONAL});options.get("secureProto")+$a.get("serviceHost");auth.isAuthenticated(function(c){if(a.error)return log.error((b&&b.tab?b.tab.url+"\n\n":"")+a.error),b&&b.tab&&b.tab.url&&A({category:"Errors",action:"Serializer: "+a.error.substr(0,200),label:b.tab.url}),void h({name:"fail",error:a.error},c);if(!c)return log.log("logged out while trying to clip"),void h({name:"fail"},c);if(a.userSelectedNotebook&&a.notebook.guid){var d=Persistent.get("recentNotebooks");d||(d={}),d[c.userId]=a.notebook.guid,Persistent.set("recentNotebooks",d)}a.notebook.type===GlobalUtils.NOTEBOOK_TYPE_PERSONAL?(c.urls.noteStoreUrl||log.error("Missing noteStoreUrl while clipping to personal notebook"),g(c.authenticationToken,c.urls.noteStoreUrl,c,c.userId)):a.notebook.type===GlobalUtils.NOTEBOOK_TYPE_LINKED?new RSVP.Promise(function(b,d){var e;a.notebook.noteStoreUrl?e=La(decodeURIComponent(a.notebook.noteStoreUrl)):(log.warn("Missing noteStoreUrl while clipping to linked notebook, using shardId client"),e=Oa(a.notebook.shardId)),e.authenticateToSharedNotebook(a.notebook.globalId,c.authenticationToken,b,d)}).then(function(a){a.urls.noteStoreUrl||log.error("Missing noteStoreUrl after authenticateToSharedNotebook"),g(a.authenticationToken,a.urls.noteStoreUrl,c,a.user.id)},function(a){log.error("Error authenticating to shared notebook: "+a.__proto__.name+JSON.stringify(a)),h({name:"fail",error:a},c)}):a.notebook.type===GlobalUtils.NOTEBOOK_TYPE_BUSINESS&&(c.bizUrls.noteStoreUrl||log.error("Missing biz noteStoreUrl while clipping to business notebook"),g(c.bizAuthenticationToken,c.bizUrls.noteStoreUrl,c,c.bizUserId))})}function xa(){if(a(),ya()){var c=new Bootstrapper;c.bootstrap(b,!0)}else b(!0);
}function ya(){var a=Persistent.get("previousLang");return navigator.language!==a?(Persistent.set("previousLang",navigator.language),!0):!Persistent.hasKey("BootstrapInfoIndex")||!Persistent.hasKey("BootstrapInfo")}function za(a,b){(/PERMISSION_DENIED/.test(a.trace)||/AUTH_EXPIRED/.test(a.trace))&&/parameter:authenticationToken\)/.test(a.trace)?(ca({authExpired:!0},{tab:b}),b&&Browser.sendToTab(b,{name:"tellUserToLogin"})):log.error(a.trace||a.message||a.stack||a)}function Aa(a,b,c){Browser.sendToTab(b.tab,{name:"receivePersistentFlag",key:a.key,value:Persistent.get(a.key)}),a.set&&Persistent.set(a.key,a.setValue)}function Ba(a,b,c){Persistent.set(a.key,a.value)}function Ca(a,b,c){auth.completeTwoFactorAuthentication(a.auth,a.code,function(a){a.error||(Browser.setBrowserActionClickHandler(function(a){x(null,{tab:a})}),Browser.setPopup("")),Browser.getCurrentTab(function(b){a.currentTab=b,c&&c(a)})})}function Da(a,b,c){if(b&&b.tab){for(var d={},e=0;e<a.shortcuts.length;e++)d[a.shortcuts[e]]=options.get(a.shortcuts[e]);Browser.sendToTab(b.tab,{name:"receiveKeyboardShortcuts",keys:d,keyboardShortcutsEnabled:options.get("enableKeyboardShortcuts")})}}function Ea(a,b,c){auth.isAuthenticated(function(b){if(b){var c=(options.get("secureProto")+$a.get("serviceHost"),Ta()),d=new AppFeedback,e=new SupportTicket;e.applicationVersion=Browser.EVERNOTE_VERSION,e.contactEmail=auth.getUserInfo(b.userId).email,e.osInfo=a.os,e.deviceInfo=a.browser,e.subject=a.title,e.issueDescription="User agent: "+navigator.userAgent+"\nLanguage: "+navigator.language+"\n\n"+a.details,d.rating=a.rating,d.feedback=e,c.sendAppFeedback(b.authenticationToken,d,function(a){},function(a){log.error("problem sending app feedback: Error code "+a.errorCode+"\n"+a)})}else log.error("logged out while filing a support ticket")})}function Fa(a,b,c){b&&b.tab&&Browser.sendToTab(b.tab,{name:"receiveSecret",secret:UUID.generateGuid(),"for":a["for"]})}function Ga(a,b,c){alert(a.msg)}function Ha(a,b,c){var d=auth.getCurrentUser(),e=auth.getUserInfo();if(d&&!/china/i.test($a.getName())&&!e.businessId){var f=d%10;if(f>=1&&f<=4){var g=Persistent.get("promo_salesforce");g||(g={}),g[d]||(g[d]=0),g[d]<11&&(g[d]%5===0?(Persistent.set("promo_salesforce",g),Browser.sendToTab(b.tab,{name:"isEligibleForSalesforcePromo",design:f<=2?"A":"B"})):(g[d]++,Persistent.set("promo_salesforce",g)))}}}function Ia(a,b,c){var d=auth.getCurrentUser();if(d){var e=Persistent.get("promo_salesforce");e[d]+=a.inc,Persistent.set("promo_salesforce",e)}}function Ja(){function a(a,b){var c=/^https:\/\/(?:stage|stage-china|www|app)\.(?:evernote|yinxiang)\.com\/.+?ssoReturnStatus=(.+?)(?:&|$)/.exec(a);c&&b(c[1])}function b(c,d){a(d.url,function(a){chrome.tabs.onUpdated.removeListener(b),"SUCCESS"===a&&chrome.tabs.remove(c,function(){Ka()})})}function c(b){a(b.target.url,function(a){safari.application.removeEventListener("navigate",c),"SUCCESS"===a&&(b.target.close(),Ka())})}ra({url:Browser.extension.getURL("js/main/generateUrlWithTempToken.html?baseUrl="+encodeURIComponent(ja("secureProto")+na("serviceHost"))+"&targetUrl="+encodeURIComponent("/business/BusinessSecurityLogin.action?u="+auth.getCurrentUser()+"&h="+sjcl.codec.hex.fromBits(sjcl.hash.sha1.hash(auth.getUserInfo().authenticationToken))+"&clipper=true")),type:"popup",width:1012,height:435},null,function(){SAFARI?safari.application.addEventListener("navigate",c):chrome.tabs.onUpdated.addListener(b)})}function Ka(a,b,c){auth.isAuthenticated(function(a){a?(sidebarBackground.clearCachedFilingInfo(),b&&b.tab?Browser.sendToTab(b.tab,{name:"updateUserTier",bizUser:!!a.businessId,bizComplete:!!a.bizAuthenticationToken}):Browser.getCurrentTab(function(b){b&&Browser.sendToTab(b,{name:"updateUserTier",bizUser:!!a.businessId,bizComplete:!!a.bizAuthenticationToken})})):log.error("logged out while checking if SSO is done")})}function La(a){var b=new Thrift.BinaryHttpTransport(a),c=new Thrift.BinaryProtocol(b);return new NoteStoreClient(c)}function Ma(){return La(auth.getUserInfo().urls.noteStoreUrl)}function Na(){return La(auth.getUserInfo().bizUrls.noteStoreUrl)}function Oa(a){return log.warn("using deprecated createShardNoteStoreClient"),La(options.get("secureProto")+$a.get("serviceHost")+"/edam/note/"+a)}function Pa(a){var b=new Thrift.BinaryHttpTransport(a),c=new Thrift.BinaryProtocol(b);return new UserStoreClient(c)}function Qa(){return Pa(auth.getUserInfo().urls.userStoreUrl)}function Ra(){return Pa(options.get("secureProto")+$a.get("serviceHost")+"/edam/user/")}function Sa(){return Pa(auth.getUserInfo().urls.userStoreUrl)}function Ta(){var a=new Thrift.BinaryHttpTransport(auth.getUserInfo().urls.utilityUrl),b=new Thrift.BinaryProtocol(a);return new UtilityClient(b)}function Ua(a){auth.isAuthenticated(function(b){if(b){var c=Qa();c.createSessionAuthenticationToken(b.authenticationToken,function(b){a(b)},function(b){Za(b)?log.error("Error creating temp auth token: "+b.__proto__.name+" ("+b.errorCode+"): "+b.parameter):log.error("Error creating temp auth token"),a(null)})}else log.error("Not logged in while creating temp auth token"),a(null)})}function Va(a,b){Ua(function(a){Browser.sendToTab(b.tab,{name:"receiveTempToken",tempToken:a})})}function Wa(a,b,c){Browser.captureVisibleTab(b.tab,function(d){if(a.start&&a.end){var e=document.createElement("canvas"),f=new Image;f.onload=function(){var c=this.height/a.screenshotHeight;e.width=c*(a.end.x-a.start.x+1),e.height=c*(a.end.y-a.start.y+1),e.getContext("2d").drawImage(this,c*a.start.x,c*a.start.y,e.width,e.height,0,0,e.width,e.height),Browser.sendToTab(b.tab,{name:"receiveScreenshot",data:e.toDataURL()}),e=null},f.src=d,A({category:"Skitch",action:"take_screenshot",label:"portion"})}else a.contextMenu?c&&c(d):Browser.sendToTab(b.tab,{name:"receiveScreenshot",data:d}),A({category:"Skitch",action:"take_screenshot",label:"whole"})})}function Xa(a){return fb[a]}function Ya(a,b){fb[a]=b}function Za(a){return a&&a.__proto__&&a.__proto__.__proto__&&"TException"===a.__proto__.__proto__.name}var $a,_a,ab,bb,cb="content/auth_tools/login.html",db=!1,eb=!0,fb={},gb=!1,hb={};window.addEventListener("offline",function(a){log.log("Went offline.")}),window.addEventListener("online",function(a){if(log.log("Went online."),Object.keys(fb)>0){log.log("processing offline clips");for(var b in fb)wa(fb[b].note,fb[b].originatingTab)}});var ib={clipPage:"EN_safariContextClipPage",clipScreenshot:"EN_safariContextClipScreenshot",clipSelection:"EN_safariContextClipSelection",clipImage:"EN_safariContextClipImage",clipPDF:"EN_safariContextClipPDF",clipUrl:"EN_safariContextClipUrl"};SAFARI&&(safari.application.addEventListener("contextmenu",f,!1),safari.application.addEventListener("command",e,!1)),Browser.addMessageHandlers({LOGOUT:ca,main_isAuthenticated:Y,ssoComplete:Ka,getTempToken:Va,tabStatusReply:y,main_getTextResource:ha,simSearch_getNotesRelatedToSearchQuery:fa,simSearch_receivePageInfo:ga,togglePDFContextMenuOption:ta,getKeyboardShortcuts:Da,main_setOption:T,main_clearOptions:U,main_getConfig:ia,main_openTab:pa,main_openWindow:ra,main_restart:X,main_recordActivity:sa,main_getL10n:S,bounce:V,bounceToAll:W,insertCSS:ua,getPersistentFlag:Aa,setPersistentFlag:Ba,getOption:ka,submitNote:wa,coordinatorLoaded:v,toggleClipper:x,trackEvent:A,trackTiming:B,showOpenState:G,showLoggedInState:E,showLoggedInOrOutState:H,getPersistentValue:K,setPersistentValue:L,setPersistentValueForUser:M,setPersistentValueForCurrentUser:N,clearPersistent:P,addToPersistentValue:O,downloadThumbnail:Q,cropImage:R,sendAppFeedback:Ea,generateSecret:Fa,showAlert:Ga,determineSalesforcePromoEligibility:Ha,addToSalesforceCounter:Ia,openSSOPage:Ja,captureScreenshot:Wa,setBasicUpsellTimes:_,saveToEvernote:aa});var jb=[],kb={};this.setOption=la,this.getOption=ja,this.getBaseUrl=ma,this.getBootstrapInfo=na,this.getBootstrapInfoLength=oa,this.start=xa,this.startUp=b,this.createNoteStoreClient=Ma,this.createNoteStoreClientFromUrl=La,this.createBusinessNoteStoreClient=Na,this.createBusinessUserStoreClient=Sa,this.createUserStoreClient=Qa,this.createUtilityClient=Ta,this.createDefaultUserStoreClient=Ra,this.createShardNoteStoreClient=Oa,this.showLoggedInState=E,this.showLoggedOutState=F,this.msgHandlerIsAuthenticated=Y,this.msgHandlerLogin=ba,this.msgHandlerSubmitTwoStepCode=Ca,this.msgHandlerGetRegistrationLinks=ea,this.switchService=I,this.msgHandlerLogout=ca,this.getTempToken=Ua,this.handleExpiredAuth=da,this.msgHandlerOpenTab=pa,this.msgHandlerSetPersistentValue=L,this.msgHandlerOpenWindow=ra,this.msgHandlerRestart=X,this.msgHandlerRecordActivity=sa,this.toggleClipper=x,this.openSSOPage=Ja,this.getPendingNote=Xa,this.setPendingNote=Ya,this.combineRelatedNotes=z,this.trackEvent=A,this.generateUserCustomDimensions=C,this.isThriftError=Za,Object.preventExtensions(this)}Object.preventExtensions(Extension);