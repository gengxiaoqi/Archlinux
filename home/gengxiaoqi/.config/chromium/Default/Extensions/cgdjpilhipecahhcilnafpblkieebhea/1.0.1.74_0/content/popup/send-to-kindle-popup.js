/*
 Copyright (c) 2012 Amazon.com, Inc. All rights reserved.         *
*/
jQuery(function(d){var b=window.$SendToKindle={REF_SETUP:"stk_gch_setup_ddown",isSelected:!1,height:d(document).height(),bootstrap:function(){b.loadStrings();b.loadShortcuts();b.registerEvents();b.checkSelected();d(document.body).height(b.height);d(document.documentElement).height(b.height)},registerEvents:function(){d("#s2k-popup-send").on("click",b.onSendToKindle);d("#s2k-popup-preview").on("click",b.onPreview);d("#s2k-popup-options").on("click",b.onSetup);d("#s2k-popup-history").on("click",b.onHistory)},
loadStrings:function(){d.each(d("[s2k-string]"),function(){var a=d(this);a.text(chrome.i18n.getMessage(a.attr("s2k-string")))})},loadShortcuts:function(){d.each(d("[s2k-shortcut]"),function(){var a=d(this);chrome.storage.sync.get(a.attr("s2k-shortcut"),function(d){b.updateShortcut(d[a.attr("s2k-shortcut")],a)})})},updateShortcut:function(a,b){if(a){var c="";a.control&&(c+=chrome.i18n.getMessage("kbsCtrl")+" + ");a.shift&&(c+=chrome.i18n.getMessage("kbsShift")+" + ");a.alt&&(c+=chrome.i18n.getMessage("kbsAlt")+
" + ");if(47<a.key&&91>a.key)c+=String.fromCharCode(a.key);else if(36<a.key&&41>a.key)switch(a.key){case 37:c+=chrome.i18n.getMessage("kbsArrowLeft");break;case 38:c+=chrome.i18n.getMessage("kbsArrowUp");break;case 39:c+=chrome.i18n.getMessage("kbsArrowRight");break;case 40:c+=chrome.i18n.getMessage("kbsArrowDown")}else c+="F"+(a.key-111);b.text(c)}},checkSelected:function(){chrome.tabs.getSelected(null,function(a){chrome.tabs.sendRequest(a.id,{action:"text-selected"},function(a){"text-selected"===
a.action&&(!0===a.isSelected?(b.isSelected=!0,d("#s2k-popup-selected").removeClass("s2k-popup-item-disabled").on("click",b.onSendSelected)):(b.isSelected=!1,d("#s2k-popup-selected").addClass("s2k-popup-item-disabled").off("click")))})})},onSendToKindle:function(){chrome.extension.sendRequest({action:"extract",preview:!1,selected:!1});window.close()},onSendSelected:function(){chrome.extension.sendRequest({action:"extract",preview:!1,selected:b.isSelected});window.close()},onPreview:function(){chrome.extension.sendRequest({action:"extract",
preview:!0,selected:b.isSelected});window.close()},onSetup:function(){chrome.tabs.create({url:chrome.i18n.getMessage("setupUrl")+"/ref\x3d"+b.REF_SETUP})},onHistory:function(){chrome.extension.sendRequest({action:"inject"},function(){chrome.tabs.executeScript(null,{code:"function s2k_history() {     if(window.$SendToKindle !\x3d\x3d undefined \x26\x26 window.$SendToKindle.isInjected \x3d\x3d\x3d true \x26\x26 window.$SendToKindle.History !\x3d\x3d undefined) {        if (window.$SendToKindle.history \x3d\x3d\x3d undefined) {            window.$SendToKindle.history \x3d new window.$SendToKindle.History();            window.$SendToKindle.history.inject();        }    }    else {        setTimeout(s2k_history, 500);    }}s2k_history();"});
window.close()})}};b.bootstrap()});